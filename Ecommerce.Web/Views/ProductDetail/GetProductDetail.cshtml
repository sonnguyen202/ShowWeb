@model Ecommerce.Service.ViewModels.Web.ProductDetail.ProductDetailModel
@using Microsoft.AspNetCore.Http;
@using System.Web;
@{
    ViewData["Title"] = "GetProductDetail";
    Layout = "~/Views/Shared/_Layout.cshtml";
    var averageRating = 0;
    @foreach (var item in Model.ProductRatingViewModel)
    {
        averageRating += item.Number * item.Rating;
    }
    if (Model.ProductCommentViewModel.Count != 0)
    {
        averageRating = averageRating / Model.ProductCommentViewModel.Count;
    }
    else
    {
        averageRating = 0;
    }
    var ReplyCommentItem = 2;
    var numberComment = Model.ProductCommentViewModel.Count;
    var CommentPerPage = 5;
    var PageNum = Math.Ceiling((double)(numberComment) / (double)(CommentPerPage));


}

<div class="breadcrumbs">
    <div class="container">
        <div class="row">
            <div class="col">
                <p class="bread">
                    <span>
                        <a href="index.html">
                            <font style="vertical-align: inherit;">
                                <font style="vertical-align: inherit;">Trang chủ  </font>
                            </font>
                        </a>
                    </span>
                    <font style="vertical-align: inherit;">
                        <font style="vertical-align: inherit;"> /</font>
                    </font><span>
                        <font style="vertical-align: inherit;">
                            <font style="vertical-align: inherit;"> Chi tiết sản phẩm</font>
                        </font>
                    </span>
                </p>
            </div>
        </div>
    </div>
</div>


<div class="product-simple-area">
    <div class="container">
        <div class="row row-pb-lg product-detail-wrap">
            <div class="col-lg-6 col-md-6 col-sm-12 col-xs-12">
                <div class="single-product-image">
                    <div class="single-product-tab">
                        <!-- Nav tabs -->
                        <ul class="nav nav-tabs tab-image1" role="tablist">
                            @foreach (var item in Model.ProductImageFirstAttributeViewModel)
                            {
                                @if (item.IsMainImage == true)
                                {
                                    <li role="presentation" class="active">
                                        <a href="#@item.Id" aria-controls="home" role="tab"
                                           data-toggle="tab"><img alt="" src="~/images/@item.ImageLink"></a>
                                    </li>
                                }
                                else
                                {
                                    <li role="presentation">
                                        <a href="#@item.Id" aria-controls="home" role="tab"
                                           data-toggle="tab"><img alt="" src="~/images/@item.ImageLink"></a>
                                    </li>
                                }
                            }
                        </ul>

                        <!-- Tab panes -->
                        <div class="tab-content tab-image2">
                            @foreach (var item in Model.ProductImageFirstAttributeViewModel)
                            {
                                @if (item.IsMainImage == true)
                                {
                                    <div role="tabpanel" class="tab-pane active " id="@item.Id">
                                        <img alt=""
                                             src="~/images/@item.ImageLink" style="width:400px">
                                    </div>
                                }
                                else
                                {
                                    <div role="tabpanel" class="tab-pane" id="@item.Id">
                                        <img alt=""
                                             src="~/images/@item.ImageLink" style="width:400px">
                                    </div>
                                }
                            }
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-lg-6 col-md-6 col-sm-12 col-xs-12">
                <div class="single-product-info">
                    <h1 class="product_title">@Model.ProductFirstAttributeViewModel.Name</h1>
                    <div class="price-box">
                        <span class="new-price">@(Model.ProductFirstAttributeViewModel.DiscountPrice)đ</span>
                        <span class="old-price">@(Model.ProductFirstAttributeViewModel.Price)đ</span>
                    </div>
                    <div class="pro-rating">
                        <p class="rating-star-color">
                            @for (int i = 1; i <= averageRating; i++)
                            {
                                <i class="icon-star-full"></i>
                            }
                            @for (int i = 1; i <= 5 - averageRating; i++)
                            {
                                <i class="icon-star-empty"></i>
                            }
                        </p>

                    </div>
                    <div class="short-description">
                        <p>
                            @Model.ProductFirstAttributeViewModel.ShortDescription
                        </p>
                    </div>
                    <form asp-controller="Cart" asp-action="AddCart" onsubmit="return jQueryAjaxGet(this);" autocomplete="off">
                        <input name="UserId" value="@Context.Session.GetString("userId")" type="hidden" />
                        <input name="ProductId" value="@Model.ProductFirstAttributeViewModel.ProductId" type="hidden" />
                        @if (Model.ProductColorViewModel.Count != 0)
                        {
                            <div class="swatch clearfix">
                                <div class="header">
                                    Chọn màu:
                                    <span class="header-content choose-color">@Model.ProductFirstAttributeViewModel.Color</span>
                                </div>
                                @foreach (var item in Model.ProductColorViewModel)
                                {
                                    if (item.Id == Model.ProductFirstAttributeViewModel.ProductColorId )
                                    {
                                        <div class="swatch-element">
                                            <input id="@item.Id" type="radio" name="ProductColorId" class="color" value="@item.Id" data-attr="@item.Name" checked />
                                            <label for="@item.Id" style="padding: 0px 5px;">
                                                @item.Name
                                            </label>
                                        </div>
                                    }
                                    else
                                    {
                                        <div class="swatch-element">
                                            <input id="@item.Id" type="radio" name="ProductColorId" class="color" value="@item.Id" data-attr="@item.Name" />
                                            <label for="@item.Id" style="padding: 0px 5px;">
                                                @item.Name
                                            </label>
                                        </div>
                                    }
                                }
                            </div>
                        }
                        @if (Model.ProductSizeViewModel.Count != 0)
                        {
                            <div class="swatch clearfix productsize">
                                <div class="header">
                                    Chọn kích cỡ:
                                    <span class="header-content choose-size"> @Model.ProductFirstAttributeViewModel.Size</span>
                                </div>
                                @foreach (var item in Model.ProductSizeViewModel)
                                {
                                    var check = false;
                                    @foreach (var item1 in Model.ProductSizeFirstAttributeViewModel)
                                    {
                                        if (item1.Id == item.Id)
                                        {
                                            if (item1.Id == Model.ProductFirstAttributeViewModel.ProductSizeId)
                                            {
                                                <div class="swatch-element">
                                                    <input id="@item1.Id" type="radio" name="ProductSizeId" class="size" value="@item1.Id" data-attr="@item1.Name" checked />
                                                    <label for="@item1.Id">
                                                        @item1.Name
                                                    </label>
                                                </div>
                                            }
                                            else
                                            {
                                                <div class="swatch-element">
                                                    <input id="@item1.Id" type="radio" name="ProductSizeId" class="size" value="@item1.Id" data-attr="@item1.Name" />
                                                    <label for="@item1.Id">
                                                        @item1.Name
                                                    </label>
                                                </div>
                                            }
                                            check = true;
                                            break;
                                        }
                                    }
                                    if (check == false)
                                    {
                                        <div class="swatch-element">
                                            <input id="@item.Id" type="radio" name="ProductSizeId" class="size" value="@item.Id" data-attr="@item.Name" disabled />
                                            <label for="@item.Id" class="disable">
                                                @item.Name
                                            </label>
                                        </div>
                                    }
                                }
                            </div>
                        }
                        <div class="add-to-cart">
                            @*<div class="input-quantity">
                                    <p class="header">Số lượng:</p>
                                    <div class="input-group mb-4">
                                        <span class="input-group-btn" style="width:100%">
                                            <button type="button" class="quantity-left-minus btn" data-type="minus"
                                                    data-field="">
                                                <i class="icon-minus2"></i>
                                            </button>
                                        </span>
                                        <input type="text" id="quantity" name="Quantity" class="form-control input-number"
                                               value="1" min="1" max="100">
                                        <span class="input-group-btn ml-1" style="width:100%">
                                            <button type="button" class="quantity-right-plus btn" data-type="plus"
                                                    data-field="">
                                                <i class="icon-plus2"></i>
                                            </button>
                                        </span>
                                    </div>
                                </div>*@
                            <div style="margin-top:-17px;margin-right:30px" class="QualityInput__Wrapper-sc-15mlmyf-0 fXfceZ">
                                <p class="label">Số lượng:</p>
                                <div class="group-input">
                                    <button type="button" class="quantity-minus btn">-</button>
                                    <input type="text" id="quantity-num" name="Quantity" value="1" class="input">
                                    <button type="button" class="quantity-plus btn">+</button>
                                </div>
                            </div>
                            <div class="text-center">
                                <p class="addtocart">
                                    <button type="submit" class="btn btn-primary btn-addtocart">
                                        Thêm vào giỏ hàng
                                    </button>
                                </p>
                            </div>
                        </div>

                    </form>
                </div>
            </div>
        </div>

        <div class="row">
            <div class="col-sm-12">
                <div class="row">
                    <div class="col-md-12 pills">
                        <div class="bd-example bd-example-tabs">
                            <ul class="nav nav-pills mb-3" id="pills-tab" role="tablist">

                                <li class="nav-item">
                                    <a class="nav-link active" id="pills-description-tab" data-toggle="pill"
                                       href="#pills-description" role="tab" aria-controls="pills-description"
                                       aria-expanded="true">
                                        <font style="vertical-align: inherit;">
                                            <font style="vertical-align: inherit;">Mô Tả Sản Phẩm</font>
                                        </font>
                                    </a>
                                </li>
                                <li class="nav-item">
                                    <a class="nav-link" id="pills-review-tab" data-toggle="pill"
                                       href="#pills-review" role="tab" aria-controls="pills-review"
                                       aria-expanded="true">
                                        <font style="vertical-align: inherit;">
                                            <font style="vertical-align: inherit;">Đánh Giá</font>
                                        </font>
                                    </a>
                                </li>
                            </ul>

                            <div class="tab-content" id="pills-tabContent">
                                <div class="tab-pane border fade show active" id="pills-description"
                                     role="tabpanel" aria-labelledby="pills-description-tab">
                                    <div class="description">
                                        @Html.Raw(Model.ProductFirstAttributeViewModel.Description)
                                    </div>
                                </div>

                                <div class="tab-pane border fade" id="pills-review" role="tabpanel"
                                     aria-labelledby="pills-review-tab">
                                    <div class="row mb-5">
                                        <div class="col-md-8">
                                            <h3 class="head">GỬI NHẬN XÉT CỦA BẠN</h3>
                                            <div class="add-comment">
                                                <form asp-action="AddProductComment" asp-controller="ProductDetail" onsubmit="return jQueryAjaxAddComment(this);" autocomplete="off" enctype="multipart/form-data">
                                                    <input asp-for="@Model.ProductComment.UserId" value="@Context.Session.GetString("userId")" type="hidden" />
                                                    <input asp-for="@Model.ProductComment.ProductId" value="@Model.ProductFirstAttributeViewModel.ProductId" type="hidden" />
                                                    <div class="form-group" id="rating-ability-wrapper">
                                                        <div class="label-rating">
                                                            <label class="control-label" for="rating">
                                                                <span class="field-label-header">1.Đánh giá của bạn</span><br>
                                                                <span class="field-label-info"></span>

                                                            </label>
                                                        </div>
                                                        <div class="rating">
                                                            <h2 class="bold rating-header" style="">
                                                                <span class="selected-rating">0</span><small> / 5 </small>
                                                            </h2>
                                                            <input type="radio" id="rating-star-1" name="rating-star" value="1">
                                                            <label for="rating-star-1" class="btnrating btn btn-default "
                                                                   data-attr="1">
                                                                <i class="fa fa-star"
                                                                   aria-hidden="true"></i>
                                                            </label>
                                                            <input type="radio" id="rating-star-2" name="rating-star" value="2">
                                                            <label for="rating-star-2" class="btnrating btn btn-default "
                                                                   data-attr="2">
                                                                <i class="fa fa-star"
                                                                   aria-hidden="true"></i>
                                                            </label>
                                                            <input type="radio" id="rating-star-3" name="rating-star" value="3">
                                                            <label for="rating-star-3" class="btnrating btn btn-default "
                                                                   data-attr="3">
                                                                <i class="fa fa-star"
                                                                   aria-hidden="true"></i>
                                                            </label>
                                                            <input type="radio" id="rating-star-4" name="rating-star" value="4">
                                                            <label for="rating-star-4" class="btnrating btn btn-default "
                                                                   data-attr="4">
                                                                <i class="fa fa-star"
                                                                   aria-hidden="true"></i>
                                                            </label>
                                                            <input type="radio" id="rating-star-5" name="rating-star" value="5">
                                                            <label for="rating-star-5" class="btnrating btn btn-default "
                                                                   data-attr="5">
                                                                <i class="fa fa-star"
                                                                   aria-hidden="true"></i>
                                                            </label>
                                                            <input style="visibility:hidden; display:inline !important; " id="selected_rating"
                                                                   asp-for="@Model.ProductComment.Rating">
                                                        </div>
                                                        <span asp-validation-for="@Model.ProductComment.Rating" class="error-msg"></span>
                                                        <p class="comment-header">
                                                            <label class="control-label" for="comment-header">
                                                                2.Tiêu đề của nhận xét
                                                            </label>
                                                            <input type="text" id="comment-header" asp-for="@Model.ProductComment.Title" placeholder="Nhập tiêu đề nhận xét(Không bắt buộc)">
                                                        </p>
                                                        <span asp-validation-for="@Model.ProductComment.Title" class="error-msg"></span>
                                                        <p class="comment">
                                                            <label class="control-label" for="comment">
                                                                3.Nhận xét của bạn
                                                            </label>
                                                            <textarea id="comment" asp-for="@Model.ProductComment.Comment" value="" placeholder="Nhận xét của bạn về sản phẩm này"></textarea>
                                                        </p>
                                                        <span asp-validation-for="@Model.ProductComment.Comment" class="error-msg"></span>
                                                        <div class="picture-input">
                                                            <label>
                                                                4.Thêm hình sản phẩm nếu có (Tối đa 5 hình)
                                                            </label>
                                                            <div class="button-container">
                                                                <a class="button">Chọn hình</a>
                                                                <input type="file" accept="image/" asp-for="@Model.ProductComment.ImageFiles" multiple>
                                                            </div>
                                                        </div>
                                                        <button type="submit" class="btn btn-primary">Gửi đánh giá</button>
                                                    </div>
                                                </form>
                                            </div>
                                        </div>
                                        <div class="col-md-4">
                                            <div class="rating-wrap">
                                                <div class="rating-medium">
                                                    <h3 class="rating-head">Đánh giá trung bình</h3>
                                                    <p class="rating-score">
                                                        @averageRating
                                                        /5
                                                    </p>
                                                    <p class="rating-star">
                                                        @for (int i = 1; i <= averageRating; i++)
                                                        {
                                                            <i class="icon-star-full"></i>
                                                        }
                                                        @for (int i = 1; i <= 5 - averageRating; i++)
                                                        {
                                                            <i class="icon-star-empty"></i>
                                                        }
                                                    </p>
                                                    <p class="rating-number">
                                                        (@Model.ProductCommentViewModel.Count nhận xét)
                                                    </p>
                                                </div>

                                                <div class="wrap">
                                                    @foreach (var item in Model.ProductRatingViewModel)
                                                    {
                                                        <p class="star">
                                                            <span>
                                                                @for (int i = 1; i <= item.Rating; i++)
                                                                {
                                                                    <i class="icon-star-full"></i>
                                                                }
                                                                @for (int i = 1; i <= 5 - item.Rating; i++)
                                                                {
                                                                    <i class="icon-star-empty"></i>
                                                                }
                                                                (@if (Model.ProductCommentViewModel.Count != 0)
                                                                {
                                                                    @(item.Number * 100 / Model.ProductCommentViewModel.Count);

                                                                }
                                                                else
                                                                {
                                                                    @Model.ProductCommentViewModel.Count;
                                                                }%)

                                                            </span>
                                                            <span>@item.Number nhận xét</span>
                                                        </p>
                                                    }

                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="row mt-5">
                                        <div class="col-md-12 pagination-item">
                                            @foreach (var item in Model.ProductCommentViewModel)
                                            {
                                                if (Model.ProductCommentViewModel.IndexOf(item) == CommentPerPage)
                                                {
                                                    break;
                                                }
                                                <div class="review">
                                                    <div class="user-img" style="background-image: url(&quot;../../images/@item.AvatarUrl&quot;)"></div>
                                                    <div class="desc">
                                                        <h4>
                                                            <span class="text-left">@item.UserName</span>
                                                            <span class="text-right">@item.CreatedDate</span>
                                                        </h4>
                                                        <div class="rating-title">
                                                            <p class="rating-star-color" style="display:inline;">
                                                                @for (int i = 1; i <= item.Rating; i++)
                                                                {
                                                                    <i class="icon-star-full"></i>
                                                                }
                                                                @for (int i = 1; i <= 5 - item.Rating; i++)
                                                                {
                                                                    <i class="icon-star-empty"></i>
                                                                }
                                                            </p>
                                                            <span>@item.Title</span>
                                                            <span class="comment-reply">
                                                                <a class="reply" data-attr="@item.Id" onclick="reply(this)">
                                                                    <i class="icon-reply"></i>
                                                                </a>
                                                            </span>
                                                        </div>
                                                        <p class="content">
                                                            @item.Comment
                                                        </p>
                                                        <span class="images">
                                                            @foreach (var item1 in item.ListImage)
                                                            {
                                                                <img src="~/images/@item1.ImageUrl" style="margin-right:12px;margin-bottom:12px;width:175px;height:175px !important;" />
                                                            }
                                                        </span>
                                                        <div class="reply-input" data-attr="@item.Id">
                                                            <form asp-action="AddProductCommentReply" asp-controller="ProductDetail" onsubmit="return jQueryAjaxAddCommentReply(this);" autocomplete="off">
                                                                <input type="hidden" asp-for="@Model.ProductCommentReply.ProductCommentId" value="@item.Id" />
                                                                <input type="hidden" asp-for="@Model.ProductCommentReply.UserId" value="@Context.Session.GetString("userId")" />
                                                                <textarea asp-for="@Model.ProductCommentReply.Comment" placeholder="Nhập nội dung trả lời tại đây. Tối thiểu 30 từ."></textarea>
                                                                <span asp-validation-for="@Model.ProductCommentReply.Comment" class="error-msg"></span>
                                                                <div class="reply-btn">
                                                                    <button type="submit" class="btn-send">Gửi</button>
                                                                    <button type="button" class="btn-cancel" onclick="replycancel(this)" data-attr="@item.Id">Huỷ bỏ</button>
                                                                </div>
                                                            </form>
                                                        </div>
                                                        @foreach (var item2 in item.ListReply)
                                                        {
                                                            if (item.ListReply.IndexOf(item2) == ReplyCommentItem)
                                                            {
                                                                break;
                                                            }
                                                            <div class="reply-comment">
                                                                <div class="avatar" style="background-image: url(&quot;../../images/@item2.AvatarUrl&quot;)"></div>
                                                                <div class="information">
                                                                    <p class="text-user">
                                                                        <span class="text-left">@item2.UserName</span>
                                                                        <span class="text-right">@item2.CreatedDate</span>
                                                                    </p>
                                                                    <p class="text-content">@item2.Comment</p>
                                                                </div>
                                                            </div>
                                                        }
                                                        @if (item.ListReply.Count > ReplyCommentItem)
                                                        {
                                                            <button class="view-more" type="button" onclick="viewmore(this)" data-attr="@item.Id">Xem thêm</button>
                                                        }
                                                    </div>
                                                </div>
                                            }
                                        </div>
                                    </div>
                                    <ul class="Navigation__Wrapper-dgcpmq-0 kiFxlu" style="justify-content: flex-end;">
                                        @if (PageNum > 1)
                                        {
                                            for (int i = 1; i <= PageNum; i++)
                                            {
                                                if (i == 1)
                                                {
                                                    <li><a class="btnum active" data-attr="@i">@i</a></li>
                                                }
                                                else
                                                {
                                                    <li><a class="btnum " data-attr="@i" onclick="paginate(this)">@i</a></li>
                                                }
                                            }
                                            <li><a class="btnum next" onclick="paginate(this)"><svg fill="currentColor" preserveAspectRatio="xMidYMid meet" height="1em" width="1em" viewBox="0 0 40 40" style="vertical-align: middle;"><g><path d="m26.3 21.4q0 0.3-0.2 0.5l-10.4 10.4q-0.3 0.3-0.6 0.3t-0.5-0.3l-1.1-1.1q-0.2-0.2-0.2-0.5t0.2-0.5l8.8-8.8-8.8-8.7q-0.2-0.3-0.2-0.6t0.2-0.5l1.1-1.1q0.3-0.2 0.5-0.2t0.6 0.2l10.4 10.4q0.2 0.2 0.2 0.5z"></path></g></svg></a></li>
                                        }


                                    </ul>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<div class="ReactModalPortal" style="display:none;">
    <div class="ReactModal__Overlay ReactModal__Overlay--after-open" style="position: fixed; top: 0px; left: 0px; right: 0px; bottom: 0px; background: rgba(0, 0, 0, 0.53); overflow-y: scroll; z-index: 1000;">
        <div class="ReactModal__Content ReactModal__Content--after-open" tabindex="-1" role="dialog" style="position: relative; top: 0px; left: 0px; right: 0px; bottom: 0px; border: none; background: rgb(255, 255, 255); overflow: unset; border-radius: 4px; outline: none; padding: 0px; width: 500px; margin: 0px auto;">
            <span class="BSModal__Close-jrfltf-2 flnOER"></span>
            <div class="BSModal__Body-jrfltf-0 ectAiu">Bạn đã viết nhận xét cho sản phẩm này!</div>
        </div>
    </div>
</div>
<div class="formAddReply" style="display:none;">
    <form asp-action="AddProductCommentReply" asp-controller="ProductDetail" onsubmit="return jQueryAjaxAddCommentReply(this);" autocomplete="off">
        <input type="hidden" asp-for="@Model.ProductCommentReply.ProductCommentId" value="" />
        <input type="hidden" asp-for="@Model.ProductCommentReply.UserId" value="@Context.Session.GetString("userId")" />
        <textarea asp-for="@Model.ProductCommentReply.Comment" placeholder="Nhập nội dung trả lời tại đây. Tối thiểu 30 từ."></textarea>
        <span asp-validation-for="@Model.ProductCommentReply.Comment" class="error-msg"></span>
        <div class="reply-btn">
            <button type="submit" class="btn-send">Gửi</button>
            <button type="button" class="btn-cancel" onclick="replycancel(this)">Huỷ bỏ</button>
        </div>
    </form>
</div>
<div id="snack-bar">

</div>
<script src="~/js/jquery.min.js"></script>
<script>
    $(".size").click(function (event) {
        var proId = "@Model.ProductFirstAttributeViewModel.ProductId";
        var proSizeId = $(this).attr("id");
        var proSizeName = $(this).attr("data-attr");
        var proColorId = $(".color:checked").attr("id");
        $.ajax({
        type: 'Get',
        dataType: "json",
        async: false,
        url: "@Url.Action("GetProductDetailByProductSize", "ProductDetail", null, Context.Request.Scheme)",
        data: {
            productId: proId,
            productColorId: proColorId,
            productSizeId: proSizeId,
            },
            success: function (res) {
                var productDetail = JSON.parse(res.productDetail);
                $(".new-price").html(productDetail.DiscountPrice + " đ");
                $(".old-price").html(productDetail.Price + " đ");
                $(".choose-size").html(proSizeName);
        },

        error: function (err) {
            console.log(err);
        }
        })

    });
    $(".color").click(function (event) {
        var proId = "@Model.ProductFirstAttributeViewModel.ProductId";
        var proColorId = $(this).val();
        var proColorName = $(this).attr("data-attr");
        $.ajax({
        type: 'Get',
        dataType: "json",
        async: false,
        url: "@Url.Action("GetProductDetailByProductColor", "ProductDetail", null, Context.Request.Scheme)",
        data: {
            productId: proId,
            productColorId: proColorId,
            },
            success: function (res) {
                var listImage = JSON.parse(res.listImage);
                var htmlImage1 = "";
                var htmlImage2 = "";
                var productDetail = JSON.parse(res.productDetail);
                var listSize = JSON.parse(res.listSize);
                var listAllSize = JSON.parse(res.listAllSize);
                for (var i = 0; i < Object.keys(listImage).length ; i++){
                    if (listImage[i].IsMainImage == true) {
                        htmlImage1 += '<li role="presentation" class="active">'
                        htmlImage2 += '<div role="tabpanel" class="tab-pane active " id="' + listImage[i].Id + '">'
                    } else {
                        htmlImage1 += '<li role="presentation">'
                        htmlImage2 += '<div role="tabpanel" class="tab-pane " id="' + listImage[i].Id + '">'
                    }
                    htmlImage1 += '<a href="#' + listImage[i].Id + '" aria-controls="home" role="tab"'
                    htmlImage1 += 'data-toggle="tab"><img alt="" src="../../images/' + listImage[i].ImageLink + '"></a>';
                    htmlImage1 += '</li>';
                    htmlImage2 +='<img alt=""src="../../images/'+listImage[i].ImageLink+'" style="width:400px"></div>'
                }
                for (var i = 0; i < Object.keys(listAllSize).length; i++) {
                    //htmlSize += '<div class="swatch-element">';
                    //if (listSize[i].Id == productDetail.ProductSizeId) {
                    //    htmlSize += '<input id="' + listSize[i].Id + '" type="radio" name="ProductSizeId" class="size" value="' + listSize[i].Id + '" data-attr="' + listSize[i].Name + '" checked />';
                    //} else {
                    //    htmlSize += '<input id="' + listSize[i].Id + '" type="radio" name="ProductSizeId" class="size" value="' + listSize[i].Id + '" data-attr="' + listSize[i].Name + '" />';
                    //}
                    //htmlSize += '<label for="' + listSize[i].Id + '">' + listSize[i].Name + '</label></div>';
                    var check = false;
                    for (var j = 0; j < Object.keys(listSize).length; j++) {
                        if (listSize[j].Id == listAllSize[i].Id) {
                            $('#' + listSize[j].Id).removeAttr('checked');
                            $('#' + listSize[j].Id).removeAttr('disabled');
                            $('#' + listSize[j].Id).parent().find('label').removeClass('disable');
                            if (listSize[j].Id == productDetail.ProductSizeId) {
                                $('#'+listSize[j].Id).prop('checked',true);
                            }
                            check = true;
                            break;
                        }
                    }
                    if (check == false) {
                        $('#' + listAllSize[i].Id).removeAttr('checked');
                        $('#' + listAllSize[i].Id).parent().find('label').removeClass('disable').addClass('disable');
                        $('#'+listAllSize[i].Id).prop('disabled',true);
                    }
                }
                $(".tab-image1").html(htmlImage1);
                $(".tab-image2").html(htmlImage2);
                $(".choose-size").html(productDetail.Size);
                $(".choose-color").html(proColorName);
                $(".new-price").html(productDetail.DiscountPrice + " đ");
                $(".old-price").html(productDetail.Price + " đ");

        },

        error: function (err) {
            console.log(err);
        }
        })

    })
    function paginate(event) {
        var currentPage = $(".kiFxlu a.active").attr("data-attr");
        var nextPage;
        if ($(event).hasClass("next")) {
            nextPage = Number(currentPage) + 1;
        } else if ($(event).hasClass("prev")) {
            nextPage = Number(currentPage) - 1;
        } else {
            nextPage = $(event).attr("data-attr");
        }
        $('<li><a class="btnum active" data-attr="' + nextPage + '">' + nextPage + '</a></li>').insertAfter($(".btnum[data-attr=" + nextPage + "]").parent());
        $('<li><a class="btnum " data-attr="' + currentPage + '"onclick="paginate(this)">' + currentPage + '</a></li>').insertAfter($(".btnum[data-attr=" + currentPage + "]").parent());
        $(".btnum[data-attr=" + currentPage + "]").first().parent().remove();
        $(".btnum[data-attr=" + nextPage + "]").first().parent().remove();
        if (nextPage == 1) {
            $(".kiFxlu .prev").parent().remove();
        } else if (nextPage == @PageNum) {
            $(".kiFxlu .next").parent().remove();
        }
        if (currentPage == 1) {
            $(".kiFxlu").prepend('<li><a class="btnum prev" onclick="paginate(this)"><svg fill="currentColor" preserveAspectRatio="xMidYMid meet" height="1em" width="1em" viewBox="0 0 40 40" style="vertical-align: middle;"><g><path d="m26.5 12.1q0 0.3-0.2 0.6l-8.8 8.7 8.8 8.8q0.2 0.2 0.2 0.5t-0.2 0.5l-1.1 1.1q-0.3 0.3-0.6 0.3t-0.5-0.3l-10.4-10.4q-0.2-0.2-0.2-0.5t0.2-0.5l10.4-10.4q0.3-0.2 0.5-0.2t0.6 0.2l1.1 1.1q0.2 0.2 0.2 0.5z"></path></g></svg></a></li>');
        } else if (currentPage == @PageNum) {
            $(".kiFxlu").append('<li><a class="btnum next" onclick="paginate(this)"><svg fill="currentColor" preserveAspectRatio="xMidYMid meet" height="1em" width="1em" viewBox="0 0 40 40" style="vertical-align: middle;"><g><path d="m26.3 21.4q0 0.3-0.2 0.5l-10.4 10.4q-0.3 0.3-0.6 0.3t-0.5-0.3l-1.1-1.1q-0.2-0.2-0.2-0.5t0.2-0.5l8.8-8.8-8.8-8.7q-0.2-0.3-0.2-0.6t0.2-0.5l1.1-1.1q0.3-0.2 0.5-0.2t0.6 0.2l10.4 10.4q0.2 0.2 0.2 0.5z"></path></g></svg></a></li>');
        }

        var productId ="@Model.ProductFirstAttributeViewModel.ProductId";
        var skip = @CommentPerPage* (nextPage - 1);
        var take = @CommentPerPage;
        $.ajax({ // Hàm ajax
            type: "get", //Phương thức truyền post hoặc get
            dataType: "json", //Dạng dữ liệu trả về xml, json, script, or html
            async: false,
            url: "@Url.Action("GetProductCommentPagination", "ProductDetail", null, Context.Request.Scheme)", // Nơi xử lý dữ liệu
            data: {
                productId: productId,
                skip: skip,
                take: take,
            },
            beforeSend: function () {
                // Có thể thực hiện công việc load hình ảnh quay quay trước khi đổ dữ liệu ra
            },
            success: function (res) {
                var json = JSON.parse(res.html);
                var jsonLength = Object.keys(json).length
                $(".pagination-item").html('');
                for (var i = 0; i < jsonLength; i++){
                    var html = ''
                     html += '<div class="review">';
                     html += '<div class="user-img"style="background-image: url(&quot;../../images/'+json[i].AvatarUrl+'&quot;)"></div>';
                     html += '<div class="desc"><h4><span class="text-left">'+json[i].UserName+'</span><span class="text-right">'+json[i].CreatedDate+'</span></h4>';
                    html += '<div class="rating-title"><p class="rating-star-color" style="display:inline;">';
                    for (var a = 1; a <= json[i].Rating; a++) {
                        html+='<i class="icon-star-full"></i>'
                    }
                    for (var b = 1; b <= 5-json[i].Rating; b++) {
                        html+='<i class="icon-star-empty"></i>'
                    }
                    html += '</p><span>' + json[i].Title + '</span><span class="comment-reply"><a class="reply" data-attr="' + json[i].Id + '" onclick="reply(this)"><i class="icon-reply"></i></a></span></div><p class="content">' + json[i].Comment + '</p><span class="images">';
                    for (var j = 0; j < Object.keys(json[i].ListImage).length; j++) {
                        html += '<img src="../../images/'+json[i].ListImage[j].ImageUrl+'" style="margin-right:12px;margin-bottom:12px;width:175px;height:175px !important;" />';
                    }
                     html += '</span><div class="reply-input" data-attr="'+json[i].Id+'"></div>';
                    @*html += '@Html.HiddenFor(model => model.ProductCommentReply.Id)' + '@Html.HiddenFor(model => model.ProductCommentReply.UserId)';
                    html += '@Html.TextAreaFor(model=> model.ProductCommentReply.Comment)';
                    html += '@Html.ValidationMessageFor(model => model.ProductCommentReply.Comment,"",new { @class="error-msg"})';*@
                    //html += '<div class="reply-btn"><button type="submit" class="btn-send">Gửi</button><button type="button" class="btn-cancel" onclick="replycancel(this)" data-attr="' + json[i].Id + '">Huỷ bỏ</button></div></form></div>';
                    for (var k = 0; k < Object.keys(json[i].ListReply).length; k++) {
                        if (k ==@ReplyCommentItem) {
                            break;
                        }
                        html += '<div class="reply-comment"><div class="avatar" style="background-image: url(&quot;../../images/' + json[i].ListReply[k].AvatarUrl + '&quot;)"></div><div class="information"><p class="text-user"><span class="text-left">' + json[i].ListReply[k].UserName + '</span><span class="text-right">' + json[i].ListReply[k].CreatedDate + '</span></p><p class="text-content">' + json[i].ListReply[k].Comment + '</p></div></div>';
                    }
                    if (Object.keys(json[i].ListReply).length >@ReplyCommentItem) {
                        html += '<button class="view-more" type="button" onclick="viewmore(this)" data-attr="'+json[i].Id+'">Xem thêm</button>';
                    }
                    html += '</div></div>';
                    $(".pagination-item").append(html);
                    var data = json[i].Id;
                    var form = $('.formAddReply').html();
                    $('.reply-input[data-attr=' + data + ']').append(form)
                    $('.reply-input[data-attr=' + data + '] #ProductCommentReply_ProductCommentId').val(data);
                    $('.reply-input[data-attr=' + data + '] .btn-cancel').attr('data-attr',data);

                  }
                //$(".pagination-item").html(html);
                $('.reply-input').hide();
                $('html, body').animate({
                scrollTop: $('.pagination-item').offset().top
			}, 500,'easeInOutSine');

            },
            error: function (jqXHR, textStatus, errorThrown) {
                //Làm gì đó khi có lỗi xảy ra
                console.log('The following error occured: ' + textStatus, errorThrown);
            }
        });
        $('script[src="/lib/jquery-validation/dist/jquery.validate.min.js"]').remove();
        $('script[src="/lib/jquery-validation-unobtrusive/jquery.validate.unobtrusive.min.js"]').remove();
        var reloadJs1 = document.createElement("script");
        reloadJs1.src = '/lib/jquery-validation/dist/jquery.validate.min.js';
        $("body").append(reloadJs1);
        var reloadJs2 = document.createElement("script");
        reloadJs2.src = '/lib/jquery-validation-unobtrusive/jquery.validate.unobtrusive.min.js';
        $("body").append(reloadJs2);



    }
</script>
@section Scripts {
    @{await Html.RenderPartialAsync("_ValidationScriptsPartial");}
}



